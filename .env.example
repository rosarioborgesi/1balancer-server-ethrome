# =====================================
# 1Balancer Server Configuration
# =====================================
# Copy this file to .env and fill in the required values
# Keep .env file private - DO NOT commit to git

# =====================================
# Server Configuration
# =====================================

# Port where Express server runs
# Development: 3001 (3000 is used by Next.js frontend)
# Production: 3001 or configured by your hosting
PORT=3001

# =====================================
# Arbitrum Sepolia Network Configuration (Token Swaps)
# =====================================
# These settings are for executing token swaps on Arbitrum Sepolia

# Private key of the server wallet that will execute swaps
# IMPORTANT: Must be the same wallet configured as REBALANCER_WALLET
# Get from: MetaMask > Account Details > Export Private Key
# WARNING: Never share this key! Keep it secret!
PRIVATE_KEY=0x

# RPC endpoint for Arbitrum Sepolia network (where swaps happen)
# Options:
#   - https://sepolia-rollup.arbitrum.io/rpc (official)
#   - https://arbitrum-sepolia-rpc.publicnode.com (public node)
NODE_URL=https://sepolia-rollup.arbitrum.io/rpc

# 1inch API token for swap execution
# Get from: https://portal.1inch.dev/
# Required for swap quotes and execution
DEV_PORTAL_API_TOKEN=your_1inch_api_token_here

# =====================================
# iExec Configuration (TEE Execution)
# =====================================
# These settings are for triggering iExec TEE workers on Bellecour

# Address of your deployed iExec app
# Get this after running: iexec app deploy
# Format: 0x1234567890123456789012345678901234567890
# CRITICAL: Must match NEXT_PUBLIC_IEXEC_APP_ADDRESS in frontend
IEXEC_APP_ADDRESS=0x

# Workerpool to use for task execution (default: prod-v8-bellecour)
# This shouldn't need to change
IEXEC_WORKERPOOL_ADDRESS=prod-v8-bellecour.main.pools.iexec.eth

# RPC endpoint for Bellecour (iExec's blockchain)
# This is different from Base! iExec orders go to Bellecour
IEXEC_RPC_URL=https://bellecour.iex.ec

# =====================================
# Rebalancing Logic
# =====================================

# How often to check for rebalancing opportunities (milliseconds)
# 300000 = 5 minutes (good for development)
# 60000 = 1 minute (faster testing)
# 3600000 = 1 hour (production)
REBALANCING_INTERVAL=300000

# Percentage threshold before triggering rebalancing
# 0.01 = 1% (rebalance if portfolio deviates by 1% from 50/50)
# 0.05 = 5% (less frequent rebalancing)
# 0.001 = 0.1% (very frequent rebalancing)
OFFSET=0.01

# =====================================
# Setup Instructions
# =====================================

# Step 1: Get a Server Wallet
# - MetaMask: Create a new account for production safety
# - Copy the address (0x...)
# - Export the private key (Settings > Account Details)

# Step 2: Deploy iExec App
# cd 1balancer-server-ethrome
# iexec app deploy
# Copy the app address from output

# Step 3: Fund Wallets
# Server wallet needs:
# - Base Network: 0.1 ETH (for gas fees on swaps)
# - Bellecour Network: 1+ RLC (for iExec orders)
#   Get Bellecour RLC: https://faucet.iex.ec

# Step 4: Fill in Environment Variables
# - PRIVATE_KEY: Your server wallet's private key
# - IEXEC_APP_ADDRESS: Address from step 2
# - All other values as shown above

# Step 5: Verify Configuration
# pnpm dev
# Check console output for:
# - "Server listening on port 3001"
# - "Server wallet address: 0x..."
# - "iExec app address: 0x..." (NOT "NOT CONFIGURED")

# =====================================
# Important Notes
# =====================================

# =====================================
# Network Architecture
# =====================================

# Arbitrum Sepolia (testnet):
#   - Token swaps: WETH/USDC on Arbitrum Sepolia
#   - RPC: https://sepolia-rollup.arbitrum.io/rpc
#   - Explorer: https://sepolia.arbiscan.io
#   - WETH: 0xE591bf4550f521D88537AbC3B2519d39bFFb62a0
#   - USDC: 0x75faf114eafb1BDEaC50eF6582f0F6C74d2A361c

# Bellecour (iExec's blockchain):
#   - iExec orders and TEE execution
#   - DataProtector protected data storage
#   - RPC: https://bellecour.iex.ec
#   - Explorer: https://blockscout-bellecour.iex.ec

# This is correct! Protected data lives on Bellecour,
# but swaps execute on Arbitrum Sepolia.

# Private Key Security:
# - Never commit .env file to git
# - Add to .gitignore
# - Never share your private key
# - For production: use environment variable management service
#   (AWS Secrets Manager, HashiCorp Vault, etc.)

# Rebalancing Flow:
# 1. Server receives strategy with protected data address from frontend
# 2. Every REBALANCING_INTERVAL milliseconds, server checks all strategies
# 3. If portfolio deviates by OFFSET or more, server triggers iExec
# 4. iExec starts TEE worker with the private key encrypted
# 5. TEE decrypts key and executes rebalancing swaps
# 6. Results returned to server

# Testing:
# curl http://localhost:3001/          # Check server status
# curl http://localhost:3001/health    # Health check
# curl http://localhost:3001/strategies  # View all strategies
# curl -X POST http://localhost:3001/trigger/0x... # Manually trigger rebalance
